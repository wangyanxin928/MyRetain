
define(function (require) {
    "use strict";
    //导入列表模板
    var tpl = require('text!tpl/showPage/questionnairList.html'),
        template = _.template(tpl), _this;

    //引入datatable
    var DataTable = require('plugins/DataTableView/DataTable');

    return Backbone.View.extend({
        className: "page-content",//如果不添加会document中多一级div
        initialize: function () {
            _this = this;
            this.render();
        },
        render: function () {
            this.$el.html(template(this.model));
            return this;
        },
        afterRender: function () {
            //加载datatable中数据
            this.initData();
        },
        events: {

        },

        //初始化列表
        initData: function () {
            var me = this;
            var options = {
                // 数据来源方法
                data: {
                    // 异步数据源
                    sync: function (syncOptions, callback) {
                        //获取问卷名称的值
                        var quesNameSearch = $("#quesNameSearch").val();
                        //获取自己创建的问卷
                        var JSONPARAM = {page_num: syncOptions.data.page, page_size: syncOptions.data.rows};
                        JSONPARAM.use_role = "";
                        JSONPARAM.questionnaire_name = quesNameSearch;
                        JSONPARAM.load_user_id = "user1"; //测试数据
                        JSONPARAM.use_xueduan_items = "";
                        require(['btcommon/ajax'], function () {
                            PublicAjax.ajaxGet(PublicAjax.ajaxUrl.getQuestionnaireList, JSON.stringify(JSONPARAM), function (_d) {
                                callback && callback({rows: _d.resultdata, total: _d.rows});
                            })
                        });

                    },
                    // 数据列表的索引
                    dataArrayIndex: 'rows',
                    // 分页参数
                    paging: {
                        enable: true,
                        // 每页数据条数
                        pageSize: 10
                    },
                    collection: Backbone.Collection//DataSourceCollection
                },
                //显示序号列
                displayIndex: true,
                //列显示循序：
                columns: [
                    {
                        text: "问卷名称",
                        dataIndex: "questionnaire_name",
                        render: function (value, row) {
                            return "<span questionnaire_id='"+row["questionnaire_id"]+"'>"+row["questionnaire_name"]+"</span> ";
                        }
                    },

                ],
                // 默认多选模式
                "selModel": {
                    mode: "multi",
                    // 是否显示行的checkbox
                    checkbox: true,
                },
                //表头、表数据初始化完成后调用
                initTableEventsCall: function () {
                    //为table中的删除按钮添加事件：
                    me.$(".deleteData").click(function (_event) {
                        _event.stopPropagation();
                        var _event = _event || event;
                        var row = _event.srcElement ? _event.srcElement : _event.target;
                        var $this = $(row);
                        me.needDeleteId = $this.attr("data-id");
                        _this.$('#confirm').modal('show');
                    });
                }
            };
            this.dataTable = new DataTable(options);
            // 渲染至页面
            this.$("#dataTableWrapperQ").html(this.dataTable.$el);
        },

    });
});